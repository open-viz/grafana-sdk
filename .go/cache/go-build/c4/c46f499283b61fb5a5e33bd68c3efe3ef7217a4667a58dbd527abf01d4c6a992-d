// Code generated by cmd/cgo; DO NOT EDIT.

//line /usr/local/go/src/os/user/getgrouplist_unix.go:1:1
// Copyright 2016 The Go Authors. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.

//go:build (dragonfly || freebsd || (!android && linux) || netbsd || openbsd || (solaris && !illumos)) && cgo && !osusergo
// +build dragonfly freebsd !android,linux netbsd openbsd solaris,!illumos
// +build cgo
// +build !osusergo

package user

/*
#include <unistd.h>
#include <sys/types.h>
#include <grp.h>

static int mygetgrouplist(const char* user, gid_t group, gid_t* groups, int* ngroups) {
	return getgrouplist(user, group, groups, ngroups);
}
*/
import _ "unsafe"
import (
	"fmt"
	"unsafe"
)

func getGroupList(name * /*line :27:25*/_Ctype_char /*line :27:31*/, userGID  /*line :27:41*/_Ctype_gid_t /*line :27:48*/, gids * /*line :27:56*/_Ctype_gid_t /*line :27:63*/, n * /*line :27:68*/_Ctype_int /*line :27:73*/)  /*line :27:75*/_Ctype_int /*line :27:80*/ {
	return ( /*line :28:9*/_Cfunc_mygetgrouplist /*line :28:24*/)(name, userGID, gids, n)
}

// groupRetry retries getGroupList with much larger size for n. The result is
// stored in gids.
func groupRetry(username string, name []byte, userGID  /*line :33:55*/_Ctype_gid_t /*line :33:62*/, gids *[] /*line :33:72*/_Ctype_gid_t /*line :33:79*/, n * /*line :33:84*/_Ctype_int /*line :33:89*/) error {
	// More than initial buffer, but now n contains the correct size.
	if *n > maxGroups {
		return fmt.Errorf("user: %q is a member of more than %d groups", username, maxGroups)
	}
	*gids = make([] /*line :38:17*/_Ctype_gid_t /*line :38:24*/, *n)
	rv := getGroupList((* /*line :39:23*/_Ctype_char /*line :39:29*/)(unsafe.Pointer(&name[0])), userGID, &(*gids)[0], n)
	if rv == -1 {
		return fmt.Errorf("user: list groups for %s failed", username)
	}
	return nil
}
